<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GraveBOT - Kontrol Paneli</title>
    <link rel="icon" type="image/png" href="logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&family=JetBrains+Mono:wght@400;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f0f13;
            color: white;
            overflow-x: hidden;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0f0f13;
        }
        ::-webkit-scrollbar-thumb {
            background: #3b3b4f;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a855f7;
        }

        .glass-panel {
            background: rgba(26, 26, 32, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .sidebar-link.active {
            background: linear-gradient(90deg, rgba(168, 85, 247, 0.15) 0%, transparent 100%);
            border-left: 3px solid #a855f7;
            color: #a855f7;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: rgba(168, 85, 247, 0.3);
            box-shadow: 0 10px 30px -10px rgba(168, 85, 247, 0.2);
        }
    </style>
</head>
<body class="bg-[#0f0f13] min-h-screen flex">

    <!-- Login Overlay -->
    <div id="login-overlay" class="fixed inset-0 z-[100] bg-[#0f0f13] flex items-center justify-center hidden">
        <div class="glass-panel p-8 rounded-3xl w-full max-w-md text-center border border-white/10 shadow-2xl relative overflow-hidden">
            <!-- Background Glow -->
            <div class="absolute -top-20 -left-20 w-60 h-60 bg-purple-600/20 rounded-full blur-[100px]"></div>
            <div class="absolute -bottom-20 -right-20 w-60 h-60 bg-blue-600/20 rounded-full blur-[100px]"></div>

            <div class="relative z-10">
                <div class="w-20 h-20 bg-gradient-to-br from-purple-600 to-blue-600 rounded-2xl mx-auto mb-6 flex items-center justify-center shadow-lg shadow-purple-500/30">
                    <img src="logo.png" alt="Logo" class="w-16 h-16 object-contain">
                </div>
                
                <h2 class="text-3xl font-black text-white mb-2 tracking-tight">GraveBOT Panel</h2>
                <p class="text-gray-400 mb-8 font-medium">Sunucularınızı yönetmek için Discord hesabınızla giriş yapın.</p>
                
                <a href="/auth/discord" class="group flex items-center justify-center gap-3 bg-[#5865F2] hover:bg-[#4752C4] text-white py-4 px-6 rounded-xl font-bold transition-all transform hover:scale-[1.02] shadow-xl shadow-[#5865F2]/20">
                    <i class="fa-brands fa-discord text-2xl group-hover:rotate-12 transition-transform"></i>
                    <span>Discord ile Giriş Yap</span>
                </a>
                
                <p class="mt-6 text-xs text-gray-500">
                    Giriş yaparak <a href="#" class="text-gray-400 hover:text-white underline">Hizmet Şartları</a>'nı kabul etmiş olursunuz.
                </p>
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <aside class="fixed inset-y-0 left-0 w-64 bg-[#0a0a0c] border-r border-white/5 flex flex-col z-50 transition-transform duration-300 transform -translate-x-full md:translate-x-0" id="sidebar">
        <!-- Logo -->
        <div class="h-20 flex items-center px-8 border-b border-white/5">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-full bg-purple-600/20 flex items-center justify-center overflow-hidden">
                    <img src="logo.png" alt="Logo" class="w-full h-full object-cover">
                </div>
                <span class="font-bold text-lg tracking-wide">GraveBOT <span class="text-xs text-purple-500 bg-purple-500/10 px-2 py-0.5 rounded ml-1">PANEL</span></span>
            </div>
        </div>

        <!-- User Profile (Sidebar Top) -->
        <div id="user-profile" class="px-6 py-6 hidden">
            <div class="flex items-center gap-3 p-3 bg-white/5 rounded-xl border border-white/5">
                <img id="user-avatar" src="" alt="User" class="w-10 h-10 rounded-full border border-purple-500/30">
                <div class="flex-1 min-w-0">
                    <h4 id="user-name" class="text-sm font-bold text-white truncate">Kullanıcı</h4>
                    <a href="/auth/logout" class="text-xs text-red-400 hover:text-red-300 flex items-center gap-1">
                        <i class="fa-solid fa-right-from-bracket"></i> Çıkış Yap
                    </a>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <nav class="flex-1 overflow-y-auto py-6 px-4 space-y-1">
            <p class="px-4 text-xs font-semibold text-gray-500 uppercase tracking-wider mb-4">Genel</p>
            
            <a href="#" data-page="overview" class="sidebar-link active flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-lg text-white transition-all hover:bg-white/5">
                <i class="fa-solid fa-chart-line w-5 text-center"></i>
                Genel Bakış
            </a>
            <a href="#" data-page="servers" class="sidebar-link flex items-center gap-3 px-4 py-3 text-sm font-medium text-gray-400 rounded-lg hover:text-white hover:bg-white/5 transition-all">
                <i class="fa-solid fa-server w-5 text-center"></i>
                Sunucularım
            </a>
            <a href="#" data-page="commands" class="sidebar-link flex items-center gap-3 px-4 py-3 text-sm font-medium text-gray-400 rounded-lg hover:text-white hover:bg-white/5 transition-all">
                <i class="fa-solid fa-terminal w-5 text-center"></i>
                Komutlar
            </a>

            <div id="admin-menu" style="display: none;">
                <p class="px-4 text-xs font-semibold text-gray-500 uppercase tracking-wider mt-8 mb-4">Yönetim</p>

                <a href="#" class="sidebar-link flex items-center gap-3 px-4 py-3 text-sm font-medium text-gray-400 rounded-lg hover:text-white hover:bg-white/5 transition-all">
                    <i class="fa-solid fa-shield-halved w-5 text-center"></i>
                    Moderasyon
                </a>
                <a href="#" class="sidebar-link flex items-center gap-3 px-4 py-3 text-sm font-medium text-gray-400 rounded-lg hover:text-white hover:bg-white/5 transition-all">
                    <i class="fa-solid fa-music w-5 text-center"></i>
                    Müzik Ayarları
                </a>
                <a href="#" class="sidebar-link flex items-center gap-3 px-4 py-3 text-sm font-medium text-gray-400 rounded-lg hover:text-white hover:bg-white/5 transition-all">
                    <i class="fa-solid fa-gear w-5 text-center"></i>
                    Bot Ayarları
                </a>
            </div>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 md:ml-64 min-h-screen flex flex-col relative">
        <!-- Header -->
        <header class="h-20 bg-[#0f0f13]/80 backdrop-blur-md border-b border-white/5 flex items-center justify-between px-8 sticky top-0 z-40">
            <div class="flex items-center gap-4">
                <button id="mobile-menu-btn" class="md:hidden text-gray-400 hover:text-white">
                    <i class="fa-solid fa-bars text-xl"></i>
                </button>
                <h1 class="text-xl font-bold text-white">Genel Bakış</h1>
            </div>

            <div class="flex items-center gap-6">
                <div class="relative hidden sm:block">
                    <input type="text" id="global-search" placeholder="Sunucu veya komut ara..." class="bg-[#1a1a20] border border-white/10 rounded-full py-2 pl-10 pr-4 text-sm focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500 w-64 transition-all">
                    <i class="fa-solid fa-search absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-500 text-sm"></i>
                </div>
                <div class="relative">
                    <button id="notification-btn" class="relative text-gray-400 hover:text-white transition-colors p-2 rounded-full hover:bg-white/5">
                        <i class="fa-solid fa-bell text-lg"></i>
                        <span id="notification-badge" class="absolute top-1 right-1 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-[#0f0f13] hidden"></span>
                    </button>
                    
                    <!-- Notification Dropdown -->
                    <div id="notification-dropdown" class="absolute right-0 mt-3 w-80 bg-[#16161d] border border-white/10 rounded-2xl shadow-2xl hidden z-50 overflow-hidden">
                        <div class="p-4 border-b border-white/5 flex justify-between items-center bg-white/5">
                            <h4 class="text-sm font-bold text-white">Bildirimler</h4>
                            <button onclick="clearNotifications()" class="text-[10px] text-purple-400 hover:text-purple-300 font-bold uppercase tracking-wider">Tümünü Temizle</button>
                        </div>
                        <div id="notification-list" class="max-h-96 overflow-y-auto py-2">
                            <!-- Notifications will be here -->
                            <div class="p-8 text-center">
                                <i class="fa-solid fa-bell-slash text-2xl text-gray-600 mb-2"></i>
                                <p class="text-xs text-gray-500">Henüz yeni bir bildirim yok.</p>
                            </div>
                        </div>
                        <div class="p-3 border-t border-white/5 bg-white/5 text-center">
                            <button class="text-xs text-gray-400 hover:text-white transition-colors">Tüm Bildirimleri Gör</button>
                        </div>
                    </div>
                </div>
                <a href="index.html" class="text-sm font-medium text-purple-400 hover:text-purple-300 transition-colors">
                    Siteye Dön <i class="fa-solid fa-arrow-up-right-from-square ml-1"></i>
                </a>
            </div>
        </header>

        <!-- Content Body -->
        <div class="p-8">
            
            <!-- PAGE: OVERVIEW -->
            <div id="page-overview" class="page-content space-y-8 animate-fade-in">
                <!-- Stats Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <!-- Stat Card 1 -->
                    <div class="glass-panel p-6 rounded-2xl stat-card transition-all duration-300">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 rounded-xl bg-purple-500/10 flex items-center justify-center text-purple-500">
                                <i class="fa-solid fa-server text-xl"></i>
                            </div>
                            <span class="text-xs font-bold text-green-400 bg-green-400/10 px-2 py-1 rounded-full">+12%</span>
                        </div>
                        <h3 class="text-3xl font-bold text-white mb-1" id="stat-servers">...</h3>
                        <p class="text-sm text-gray-400">Aktif Sunucu</p>
                    </div>

                    <!-- Stat Card 2 -->
                    <div class="glass-panel p-6 rounded-2xl stat-card transition-all duration-300">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 rounded-xl bg-pink-500/10 flex items-center justify-center text-pink-500">
                                <i class="fa-solid fa-users text-xl"></i>
                            </div>
                            <span class="text-xs font-bold text-green-400 bg-green-400/10 px-2 py-1 rounded-full">+5.4%</span>
                        </div>
                        <h3 class="text-3xl font-bold text-white mb-1" id="stat-users">...</h3>
                        <p class="text-sm text-gray-400">Toplam Kullanıcı</p>
                    </div>

                    <!-- Stat Card 3 -->
                    <div class="glass-panel p-6 rounded-2xl stat-card transition-all duration-300">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 rounded-xl bg-blue-500/10 flex items-center justify-center text-blue-500">
                                <i class="fa-solid fa-terminal text-xl"></i>
                            </div>
                            <span class="text-xs font-bold text-gray-500 bg-gray-500/10 px-2 py-1 rounded-full">24s</span>
                        </div>
                        <h3 class="text-3xl font-bold text-white mb-1" id="stat-commands">...</h3>
                        <p class="text-sm text-gray-400">Komut Kullanımı</p>
                    </div>

                    <!-- Stat Card 4 -->
                    <div class="glass-panel p-6 rounded-2xl stat-card transition-all duration-300">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 rounded-xl bg-green-500/10 flex items-center justify-center text-green-500">
                                <i class="fa-solid fa-signal text-xl"></i>
                            </div>
                            <span class="text-xs font-bold text-green-400">Online</span>
                        </div>
                        <h3 class="text-3xl font-bold text-white mb-1" id="stat-ping">...</h3>
                        <p class="text-sm text-gray-400">Ortalama Ping</p>
                    </div>
                </div>

                <!-- Main Sections Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Recent Activity -->
                    <div id="admin-activities" class="lg:col-span-2 glass-panel p-6 rounded-2xl">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-lg font-bold text-white">Son Aktiviteler</h2>
                            <button class="text-xs text-purple-400 hover:text-purple-300 font-medium transition-colors">Tümünü Gör</button>
                        </div>
                        
                        <div class="space-y-4" id="activity-list">
                            <!-- Activities will be loaded here -->
                            <div class="text-center text-gray-500 py-4">Yükleniyor...</div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div id="admin-quick-actions" class="glass-panel p-6 rounded-2xl space-y-8">
                        <div>
                            <h2 class="text-lg font-bold text-white mb-6">Hızlı İşlemler</h2>
                            <div class="grid grid-cols-2 gap-4">
                                <button data-action="restart" class="quick-action-btn glass-panel p-4 rounded-xl hover:bg-white/5 transition-all text-left group">
                                    <div class="w-10 h-10 rounded-lg bg-purple-500/20 flex items-center justify-center text-purple-500 mb-3 group-hover:scale-110 transition-transform">
                                        <i class="fa-solid fa-rotate"></i>
                                    </div>
                                    <h4 class="font-bold text-white text-sm">Yeniden Başlat</h4>
                                </button>
                                <button data-action="cache" class="quick-action-btn glass-panel p-4 rounded-xl hover:bg-white/5 transition-all text-left group">
                                    <div class="w-10 h-10 rounded-lg bg-blue-500/20 flex items-center justify-center text-blue-500 mb-3 group-hover:scale-110 transition-transform">
                                        <i class="fa-solid fa-broom"></i>
                                    </div>
                                    <h4 class="font-bold text-white text-sm">Önbelleği Temizle</h4>
                                </button>
                                <button data-action="maintenance" class="quick-action-btn glass-panel p-4 rounded-xl hover:bg-white/5 transition-all text-left group">
                                    <div class="w-10 h-10 rounded-lg bg-yellow-500/20 flex items-center justify-center text-yellow-500 mb-3 group-hover:scale-110 transition-transform">
                                        <i class="fa-solid fa-triangle-exclamation"></i>
                                    </div>
                                    <h4 class="font-bold text-white text-sm">Bakım Modu</h4>
                                </button>
                                <button data-action="announce" class="quick-action-btn glass-panel p-4 rounded-xl hover:bg-white/5 transition-all text-left group">
                                    <div class="w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center text-green-500 mb-3 group-hover:scale-110 transition-transform">
                                        <i class="fa-solid fa-bullhorn"></i>
                                    </div>
                                    <h4 class="font-bold text-white text-sm">Duyuru Yap</h4>
                                </button>
                            </div>
                        </div>

                        <!-- System Health -->
                        <div id="admin-system-health">
                            <h2 class="text-lg font-bold text-white mb-4">Sistem Sağlığı</h2>
                            <div class="space-y-4">
                                <!-- CPU Usage -->
                                <div>
                                    <div class="flex justify-between mb-1">
                                        <span class="text-xs font-medium text-gray-400">CPU Kullanımı</span>
                                        <span class="text-xs font-bold text-white" id="cpu-text">%0</span>
                                    </div>
                                    <div class="w-full bg-gray-700 rounded-full h-2">
                                        <div id="cpu-bar" class="bg-purple-500 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                                    </div>
                                </div>

                                <!-- RAM Usage -->
                                <div>
                                    <div class="flex justify-between mb-1">
                                        <span class="text-xs font-medium text-gray-400">RAM Kullanımı</span>
                                        <span class="text-xs font-bold text-white" id="ram-text">%0</span>
                                    </div>
                                    <div class="w-full bg-gray-700 rounded-full h-2">
                                        <div id="ram-bar" class="bg-yellow-500 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                                    </div>
                                </div>

                                <!-- Disk Usage -->
                                <div>
                                    <div class="flex justify-between mb-1">
                                        <span class="text-xs font-medium text-gray-400">Disk Alanı</span>
                                        <span class="text-xs font-bold text-white" id="disk-text">%0</span>
                                    </div>
                                    <div class="w-full bg-gray-700 rounded-full h-2">
                                        <div id="disk-bar" class="bg-blue-500 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PAGE: SERVERS -->
            <div id="page-servers" class="page-content hidden animate-fade-in">
                <div class="glass-panel p-6 rounded-2xl">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-white">Botun Bulunduğu Sunucular</h2>
                        <span class="text-xs text-gray-400 bg-white/5 px-3 py-1 rounded-full border border-white/10">
                            Toplam: <span id="server-count-badge" class="text-purple-400 font-bold">...</span>
                        </span>
                    </div>
                    
                    <div id="server-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="text-center text-gray-500 py-12 col-span-full">
                            <i class="fa-solid fa-spinner fa-spin text-2xl mb-2"></i>
                            <p>Sunucular yükleniyor...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PAGE: COMMANDS -->
            <div id="page-commands" class="page-content hidden animate-fade-in">
                <div class="glass-panel p-6 rounded-2xl">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-white">Komut Listesi</h2>
                        <div class="relative">
                            <input type="text" id="command-search" placeholder="Komut ara..." class="bg-[#0f0f13] border border-white/10 rounded-lg py-1.5 pl-8 pr-4 text-xs focus:outline-none focus:border-purple-500 transition-colors">
                            <i class="fa-solid fa-search absolute left-2.5 top-1/2 -translate-y-1/2 text-gray-500 text-xs"></i>
                        </div>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm text-gray-400">
                            <thead class="bg-white/5 text-xs uppercase font-bold text-gray-300">
                                <tr>
                                    <th class="px-6 py-4 rounded-l-xl">Komut</th>
                                    <th class="px-6 py-4">Açıklama</th>
                                    <th class="px-6 py-4">Kategori</th>
                                    <th class="px-6 py-4 rounded-r-xl">Kullanım</th>
                                </tr>
                            </thead>
                            <tbody id="command-list" class="divide-y divide-white/5">
                                <tr>
                                    <td colspan="4" class="px-6 py-8 text-center text-gray-500">
                                        <i class="fa-solid fa-spinner fa-spin text-lg mb-2"></i>
                                        <p>Komutlar yükleniyor...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- Mobile Overlay -->
    <div id="mobile-overlay" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-40 hidden md:hidden"></div>

    <!-- Manage Server Modal -->
    <div id="manage-modal" class="fixed inset-0 z-[60] bg-black/80 backdrop-blur-sm hidden flex items-center justify-center p-4">
        <div class="glass-panel w-full max-w-4xl rounded-2xl overflow-hidden flex flex-col max-h-[90vh]">
            <!-- Modal Header -->
            <div class="p-6 border-b border-white/5 flex justify-between items-center bg-[#151518]">
                <div class="flex items-center gap-4">
                    <img id="modal-server-icon" src="" class="w-12 h-12 rounded-full border-2 border-purple-500/30">
                    <div>
                        <h3 id="modal-server-name" class="text-xl font-bold text-white">Sunucu Adı</h3>
                        <p class="text-xs text-gray-400">Sunucu Yönetimi</p>
                    </div>
                </div>
                <button onclick="closeManageModal()" class="text-gray-400 hover:text-white transition-colors">
                    <i class="fa-solid fa-xmark text-xl"></i>
                </button>
            </div>

            <div class="flex flex-1 overflow-hidden">
                <!-- Modal Sidebar -->
                <div class="w-64 bg-[#0a0a0c] border-r border-white/5 p-4 space-y-1 hidden md:block">
                    <button onclick="switchModalTab('general')" class="modal-tab-btn active w-full text-left px-4 py-3 rounded-lg text-sm font-medium text-gray-400 hover:text-white hover:bg-white/5 transition-all flex items-center gap-3" data-tab="general">
                        <i class="fa-solid fa-sliders w-5 text-center"></i> Genel Ayarlar
                    </button>
                    <button onclick="switchModalTab('welcome')" class="modal-tab-btn w-full text-left px-4 py-3 rounded-lg text-sm font-medium text-gray-400 hover:text-white hover:bg-white/5 transition-all flex items-center gap-3" data-tab="welcome">
                        <i class="fa-solid fa-door-open w-5 text-center"></i> Giriş-Çıkış
                    </button>
                    <button onclick="switchModalTab('ticket')" class="modal-tab-btn w-full text-left px-4 py-3 rounded-lg text-sm font-medium text-gray-400 hover:text-white hover:bg-white/5 transition-all flex items-center gap-3" data-tab="ticket">
                        <i class="fa-solid fa-ticket w-5 text-center"></i> Ticket Sistemi
                    </button>
                    <button onclick="switchModalTab('autorole')" class="modal-tab-btn w-full text-left px-4 py-3 rounded-lg text-sm font-medium text-gray-400 hover:text-white hover:bg-white/5 transition-all flex items-center gap-3" data-tab="autorole">
                        <i class="fa-solid fa-user-tag w-5 text-center"></i> Oto-Rol
                    </button>
                    <button onclick="switchModalTab('commands')" class="modal-tab-btn w-full text-left px-4 py-3 rounded-lg text-sm font-medium text-gray-400 hover:text-white hover:bg-white/5 transition-all flex items-center gap-3" data-tab="commands">
                        <i class="fa-solid fa-ban w-5 text-center"></i> Komut Yasaklama
                    </button>
                    <button onclick="switchModalTab('protections')" class="modal-tab-btn w-full text-left px-4 py-3 rounded-lg text-sm font-medium text-gray-400 hover:text-white hover:bg-white/5 transition-all flex items-center gap-3" data-tab="protections">
                        <i class="fa-solid fa-shield-halved w-5 text-center"></i> Koruma Ayarları
                    </button>
                    <button onclick="switchModalTab('reaction-roles')" class="modal-tab-btn w-full text-left px-4 py-3 rounded-lg text-sm font-medium text-gray-400 hover:text-white hover:bg-white/5 transition-all flex items-center gap-3" data-tab="reaction-roles">
                        <i class="fa-solid fa-icons w-5 text-center"></i> Emoji Roller
                    </button>
                    
                    <div class="mt-8 pt-4 border-t border-white/5">
                         <button onclick="leaveServer(currentGuildId)" class="w-full text-left px-4 py-3 rounded-lg text-sm font-medium text-red-400 hover:text-red-300 hover:bg-red-500/10 transition-all flex items-center gap-3">
                            <i class="fa-solid fa-right-from-bracket w-5 text-center"></i> Sunucudan Ayrıl
                        </button>
                    </div>
                </div>

                <!-- Modal Content -->
                <div class="flex-1 p-8 overflow-y-auto bg-[#0f0f13]">
                    
                    <!-- TAB: GENERAL -->
                    <div id="tab-general" class="modal-tab-content space-y-6">
                        <h4 class="text-lg font-bold text-white mb-4 border-b border-white/5 pb-2">Genel Ayarlar</h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-2">
                                <label class="text-sm font-medium text-gray-400">Komut Ön eki (Prefix)</label>
                                <input type="text" id="setting-prefix" class="w-full bg-[#1a1a20] border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-purple-500 transition-colors" placeholder="g!">
                            </div>
                            
                            <div class="space-y-2">
                                <label class="text-sm font-medium text-gray-400">Bot Dili</label>
                                <select id="setting-language" class="w-full bg-[#1a1a20] border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-purple-500 transition-colors">
                                    <option value="tr">Türkçe</option>
                                    <option value="en">English</option>
                                </select>
                            </div>
                        </div>

                        <div class="bg-blue-500/10 border border-blue-500/20 rounded-xl p-4 flex gap-3 items-start">
                            <i class="fa-solid fa-circle-info text-blue-500 mt-1"></i>
                            <div>
                                <h5 class="font-bold text-blue-400 text-sm">Bilgi</h5>
                                <p class="text-xs text-gray-400 mt-1">Prefix değişikliği anında uygulanır. Botun komutlarına erişmek için yeni prefixi kullanmanız gerekecektir.</p>
                            </div>
                        </div>
                    </div>

                    <!-- TAB: WELCOME/LEAVE -->
                    <div id="tab-welcome" class="modal-tab-content hidden space-y-8">
                        <div>
                            <h4 class="text-lg font-bold text-white mb-4 border-b border-white/5 pb-2">Hoş Geldin Mesajı (Giriş)</h4>
                            <div class="space-y-4">
                                <div class="space-y-2">
                                    <label class="text-sm font-medium text-gray-400">Kanal</label>
                                    <select id="setting-welcome-channel" class="w-full bg-[#1a1a20] border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-purple-500 transition-colors">
                                        <option value="">Devre Dışı</option>
                                    </select>
                                </div>
                                <div class="space-y-2">
                                    <label class="text-sm font-medium text-gray-400">Mesaj</label>
                                    <textarea id="setting-welcome-message" rows="3" class="w-full bg-[#1a1a20] border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-purple-500 transition-colors" placeholder="Hoşgeldin {user}, sunucumuza katıldı!"></textarea>
                                </div>
                            </div>
                        </div>

                        <div>
                            <h4 class="text-lg font-bold text-white mb-4 border-b border-white/5 pb-2">Görüşürüz Mesajı (Çıkış)</h4>
                            <div class="space-y-4">
                                <div class="space-y-2">
                                    <label class="text-sm font-medium text-gray-400">Kanal</label>
                                    <select id="setting-leave-channel" class="w-full bg-[#1a1a20] border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-purple-500 transition-colors">
                                        <option value="">Devre Dışı</option>
                                    </select>
                                </div>
                                <div class="space-y-2">
                                    <label class="text-sm font-medium text-gray-400">Mesaj</label>
                                    <textarea id="setting-leave-message" rows="3" class="w-full bg-[#1a1a20] border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-purple-500 transition-colors" placeholder="Görüşürüz {user}, sunucumuzdan ayrıldı."></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-blue-500/10 border border-blue-500/20 rounded-xl p-4 flex gap-3 items-start">
                            <i class="fa-solid fa-circle-info text-blue-500 mt-1"></i>
                            <div>
                                <h5 class="font-bold text-blue-400 text-sm">Değişkenler</h5>
                                <p class="text-xs text-gray-400 mt-1">{user}: Kullanıcıyı etiketler, {server}: Sunucu adı, {memberCount}: Toplam üye sayısı.</p>
                            </div>
                        </div>
                    </div>

                    <!-- TAB: TICKET -->
                    <div id="tab-ticket" class="modal-tab-content hidden space-y-6">
                        <h4 class="text-lg font-bold text-white mb-4 border-b border-white/5 pb-2">Ticket (Destek) Sistemi</h4>
                        
                        <div class="space-y-4">
                            <div class="space-y-2">
                                <label class="text-sm font-medium text-gray-400">Ticket Kategorisi (ID)</label>
                                <input type="text" id="setting-ticket-category" class="w-full bg-[#1a1a20] border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-purple-500 transition-colors" placeholder="Kategori ID girin (Örn: 8472...)">
                                <p class="text-[10px] text-gray-500 italic">Ticket kanallarının hangi kategoride açılacağını belirler.</p>
                            </div>

                            <div class="space-y-2">
                                <label class="text-sm font-medium text-gray-400">Log Kanalı</label>
                                <select id="setting-ticket-log" class="w-full bg-[#1a1a20] border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-purple-500 transition-colors">
                                    <option value="">Devre Dışı</option>
                                </select>
                            </div>

                            <div class="space-y-2">
                                <label class="text-sm font-medium text-gray-400">Ticket Mesajı</label>
                                <textarea id="setting-ticket-message" rows="3" class="w-full bg-[#1a1a20] border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-purple-500 transition-colors" placeholder="Ticket butonunun üzerindeki açıklama metni..."></textarea>
                            </div>
                        </div>
                        
                        <div class="glass-panel p-4 rounded-xl border border-purple-500/20 bg-purple-500/5 space-y-3">
                            <h5 class="text-xs font-bold text-purple-400 uppercase tracking-widest">Hızlı Kurulum</h5>
                            <div class="flex gap-2">
                                <select id="ticket-setup-channel" class="flex-1 bg-[#1a1a20] border border-white/10 rounded-lg px-3 py-2 text-white text-xs focus:outline-none focus:border-purple-500 transition-colors">
                                    <option value="">Kanal Seçin...</option>
                                </select>
                                <button onclick="sendTicketMessage()" class="bg-purple-600 hover:bg-purple-500 text-white text-xs font-bold px-4 py-2 rounded-lg transition-all">
                                    Butonu Gönder
                                </button>
                            </div>
                            <p class="text-[10px] text-gray-500 italic">Seçtiğiniz kanala ticket açma butonunu anında gönderir.</p>
                        </div>
                    </div>

                    <!-- TAB: AUTOROLE -->
                    <div id="tab-autorole" class="modal-tab-content hidden space-y-6">
                        <h4 class="text-lg font-bold text-white mb-4 border-b border-white/5 pb-2">Oto-Rol Sistemi</h4>
                        
                        <div class="space-y-2">
                            <label class="text-sm font-medium text-gray-400">Verilecek Rol</label>
                            <select id="setting-autorole" class="w-full bg-[#1a1a20] border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-purple-500 transition-colors">
                                <option value="">Devre Dışı</option>
                                <!-- Roller JS ile doldurulacak -->
                            </select>
                            <p class="text-xs text-gray-500">Yeni gelen üyelere otomatik olarak bu rol verilecektir. Botun rolü, verilecek rolden daha yüksekte olmalıdır.</p>
                        </div>
                    </div>

                    <!-- TAB: COMMANDS -->
                    <div id="tab-commands" class="modal-tab-content hidden space-y-6">
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="text-lg font-bold text-white">Komut Yönetimi</h4>
                            <span class="text-[10px] bg-purple-500/20 text-purple-400 px-2 py-1 rounded-md border border-purple-500/30">Gelişmiş Denetim</span>
                        </div>
                        
                        <div class="bg-yellow-500/5 border border-yellow-500/10 rounded-xl p-4 flex gap-3 items-start mb-6">
                            <i class="fa-solid fa-shield-halved text-yellow-500 mt-1"></i>
                            <div>
                                <h5 class="font-bold text-yellow-500/80 text-xs">Komut Kısıtlama Bilgisi</h5>
                                <p class="text-[11px] text-gray-500 mt-1 leading-relaxed">Kapatılan komutlar tüm sunucu üyeleri için (Yöneticiler dahil) devre dışı kalır. Komutu tekrar aktif etmek için buradan açmanız yeterlidir.</p>
                            </div>
                        </div>

                        <div id="command-categories-container" class="space-y-8">
                            <!-- JS Kategorize edilmiş komutları buraya basacak -->
                        </div>
                    </div>

                    <!-- TAB: PROTECTIONS -->
                    <div id="tab-protections" class="modal-tab-content hidden space-y-6">
                        <h4 class="text-lg font-bold text-white mb-4 border-b border-white/5 pb-2">Koruma Ayarları</h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="glass-panel p-4 rounded-xl flex items-center justify-between">
                                <div>
                                    <h5 class="text-sm font-bold text-white">Küfür Engel</h5>
                                    <p class="text-xs text-gray-500">Küfürlü mesajları otomatik siler.</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="setting-anti-swear" class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                                </label>
                            </div>

                            <div class="glass-panel p-4 rounded-xl flex items-center justify-between">
                                <div>
                                    <h5 class="text-sm font-bold text-white">Reklam/Link Engel</h5>
                                    <p class="text-xs text-gray-500">Davet linklerini ve reklamları siler.</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="setting-anti-link" class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                                </label>
                            </div>

                            <div class="glass-panel p-4 rounded-xl flex items-center justify-between">
                                <div>
                                    <h5 class="text-sm font-bold text-white">Spam Engel</h5>
                                    <p class="text-xs text-gray-500">Hızlı mesaj gönderimini engeller.</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="setting-anti-spam" class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                                </label>
                            </div>

                            <div class="glass-panel p-4 rounded-xl flex items-center justify-between">
                                <div>
                                    <h5 class="text-sm font-bold text-white">Caps Engel</h5>
                                    <p class="text-xs text-gray-500">Büyük harf kullanımını kısıtlar.</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="setting-anti-caps" class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                                </label>
                            </div>

                            <div class="glass-panel p-4 rounded-xl flex items-center justify-between">
                                <div>
                                    <h5 class="text-sm font-bold text-white">Bot Engel</h5>
                                    <p class="text-xs text-gray-500">İzinsiz bot girişlerini engeller.</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="setting-anti-bot" class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                                </label>
                            </div>

                            <div class="glass-panel p-4 rounded-xl space-y-2">
                                <h5 class="text-sm font-bold text-white">Yaş Sınırı (Gün)</h5>
                                <input type="number" id="setting-age-limit" class="w-full bg-[#1a1a20] border border-white/10 rounded-lg px-3 py-1.5 text-white text-sm focus:outline-none focus:border-purple-500" placeholder="0 (Kapalı)">
                                <p class="text-[10px] text-gray-500">Hesap bu günden yeniyse atılır.</p>
                            </div>
                        </div>

                        <div class="space-y-2 mt-4">
                            <label class="text-sm font-medium text-gray-400">Yasaklı Taglar (Virgül ile ayır)</label>
                            <input type="text" id="setting-banned-tags" class="w-full bg-[#1a1a20] border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-purple-500 transition-colors" placeholder="TAG1, TAG2, ...">
                        </div>
                    </div>

                    <!-- TAB: REACTION ROLES -->
                    <div id="tab-reaction-roles" class="modal-tab-content hidden space-y-6">
                        <h4 class="text-lg font-bold text-white mb-4 border-b border-white/5 pb-2">Emoji Rol Sistemi</h4>
                        
                        <!-- Add New Reaction Role Form -->
                        <div class="glass-panel p-6 rounded-xl space-y-4 border border-white/10">
                            <h5 class="text-sm font-bold text-purple-400 uppercase tracking-wider">Yeni Emoji Rol Ekle</h5>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="space-y-2">
                                    <label class="text-xs font-medium text-gray-500">Kanal</label>
                                    <select id="rr-channel" class="w-full bg-[#1a1a20] border border-white/10 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-purple-500 transition-colors">
                                        <!-- Channels will be populated -->
                                    </select>
                                </div>
                                <div class="space-y-2">
                                    <label class="text-xs font-medium text-gray-500">Mesaj ID</label>
                                    <input type="text" id="rr-message-id" class="w-full bg-[#1a1a20] border border-white/10 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-purple-500 transition-colors" placeholder="84729...">
                                </div>
                                <div class="space-y-2">
                                    <label class="text-xs font-medium text-gray-500">Emoji</label>
                                    <input type="text" id="rr-emoji" class="w-full bg-[#1a1a20] border border-white/10 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-purple-500 transition-colors" placeholder="⭐">
                                </div>
                                <div class="space-y-2">
                                    <label class="text-xs font-medium text-gray-500">Rol</label>
                                    <select id="rr-role" class="w-full bg-[#1a1a20] border border-white/10 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-purple-500 transition-colors">
                                        <!-- Roles will be populated -->
                                    </select>
                                </div>
                            </div>
                            <button onclick="addReactionRole()" class="w-full bg-purple-600 hover:bg-purple-500 text-white text-sm font-bold py-2 rounded-lg transition-all transform hover:scale-[1.02]">
                                <i class="fa-solid fa-plus mr-2"></i> Sistemi Kur
                            </button>
                        </div>

                        <!-- Existing Reaction Roles List -->
                        <div class="space-y-3">
                            <h5 class="text-sm font-bold text-gray-400 uppercase tracking-wider">Mevcut Emoji Roller</h5>
                            <div id="rr-list" class="space-y-2">
                                <!-- RR items will be populated -->
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Modal Footer -->
            <div class="p-6 border-t border-white/5 bg-[#151518] flex justify-end gap-3">
                <button onclick="closeManageModal()" class="px-6 py-2 rounded-lg text-sm font-bold text-gray-400 hover:text-white hover:bg-white/5 transition-all">İptal</button>
                <button onclick="saveGuildSettings()" class="px-6 py-2 rounded-lg text-sm font-bold bg-purple-600 hover:bg-purple-500 text-white shadow-lg shadow-purple-500/20 transition-all transform hover:scale-105">
                    <i class="fa-solid fa-save mr-2"></i> Kaydet
                </button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        AOS.init();

        // Check Auth on Load
        async function checkAuth() {
            try {
                const response = await fetch('/api/user');
                if (response.status === 401) {
                    // Not logged in, show login overlay
                    document.getElementById('login-overlay').classList.remove('hidden');
                    return false;
                }
                const user = await response.json();
                
                // Show user info
                document.getElementById('user-profile').classList.remove('hidden');
                document.getElementById('user-name').innerText = user.username;
                document.getElementById('user-avatar').src = `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png`;
                
                // Admin değilse panelleri gizle
                if (!user.isAdmin) {
                    const activityPanel = document.getElementById('admin-activities');
                    const quickActionsPanel = document.getElementById('admin-quick-actions');
                    const systemHealthPanel = document.getElementById('admin-system-health');
                    const adminMenu = document.getElementById('admin-menu');

                    if(activityPanel) activityPanel.style.display = 'none';
                    if(quickActionsPanel) quickActionsPanel.style.display = 'none';
                    if(systemHealthPanel) systemHealthPanel.style.display = 'none';
                    if(adminMenu) adminMenu.style.display = 'none';
                } else {
                    // Admins see everything
                    const adminMenu = document.getElementById('admin-menu');
                    if(adminMenu) adminMenu.style.display = 'block';
                }

                return true;
            } catch (e) {
                console.error("Auth check failed", e);
                return false;
            }
        }

        // Modal Functions
        let currentGuildId = null;

        async function openManageModal(guildId) {
            currentGuildId = guildId;
            const modal = document.getElementById('manage-modal');
            
            // Show modal
            modal.classList.remove('hidden');
            
            // Loading indicator for header
            document.getElementById('modal-server-name').innerText = "Yükleniyor...";
            
            try {
                const response = await fetch(`/api/server/${guildId}`);
                const data = await response.json();

                if (data.error) throw new Error(data.error);

                // Update Header
                document.getElementById('modal-server-name').innerText = data.name;
                document.getElementById('modal-server-icon').src = data.icon;
                
                // Populate Channels
                const channelSelects = [
                    document.getElementById('setting-welcome-channel'),
                    document.getElementById('setting-leave-channel'),
                    document.getElementById('setting-ticket-log'),
                    document.getElementById('ticket-setup-channel'),
                    document.getElementById('rr-channel')
                ];
                
                channelSelects.forEach(select => {
                    if (!select) return;
                    select.innerHTML = '<option value="">Seçiniz...</option>';
                    data.textChannels.forEach(channel => {
                        const option = document.createElement('option');
                        option.value = channel.id;
                        option.innerText = `#${channel.name}`;
                        select.appendChild(option);
                    });
                });

                // Populate Roles
                const roleSelects = [
                    document.getElementById('setting-autorole'),
                    document.getElementById('rr-role')
                ];
                
                roleSelects.forEach(select => {
                    if (!select) return;
                    select.innerHTML = '<option value="">Seçiniz...</option>';
                    data.guildRoles.forEach(role => {
                        const option = document.createElement('option');
                        option.value = role.id;
                        option.innerText = role.name;
                        select.appendChild(option);
                    });
                });

                // Populate Reaction Roles List
                renderReactionRoles(data.reactionRoles);

                // Populate Command Banning List
                const cmdResponse = await fetch('/api/commands');
                const allCommands = await cmdResponse.json();
                const container = document.getElementById('command-categories-container');
                container.innerHTML = '';
                
                // Kategorilere ayır
                const categories = {};
                allCommands.forEach(cmd => {
                    if (!categories[cmd.category]) categories[cmd.category] = [];
                    categories[cmd.category].push(cmd);
                });

                for (const catName in categories) {
                    const catSection = document.createElement('div');
                    catSection.className = 'space-y-4';
                    
                    const catHeader = document.createElement('div');
                    catHeader.className = 'flex items-center gap-3 border-b border-white/5 pb-2';
                    catHeader.innerHTML = `
                        <i class="fa-solid fa-folder-open text-purple-500 text-xs"></i>
                        <h5 class="text-xs font-bold text-gray-400 uppercase tracking-widest">${catName} Komutları</h5>
                    `;
                    catSection.appendChild(catHeader);

                    const grid = document.createElement('div');
                    grid.className = 'grid grid-cols-1 md:grid-cols-2 gap-3';
                    
                    categories[catName].forEach(cmd => {
                        const isDisabled = data.settings.disabledCommands && data.settings.disabledCommands.includes(cmd.name);
                        const cmdCard = document.createElement('div');
                        cmdCard.className = `flex items-center justify-between p-3 rounded-xl border transition-all ${isDisabled ? 'bg-red-500/5 border-red-500/10' : 'bg-white/5 border-white/5'}`;
                        cmdCard.innerHTML = `
                            <div class="flex flex-col">
                                <span class="text-sm font-bold ${isDisabled ? 'text-red-400' : 'text-gray-200'}">${cmd.name}</span>
                                <span class="text-[10px] text-gray-500">${cmd.description || 'Açıklama yok'}</span>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer scale-90">
                                <input type="checkbox" name="disabled-cmd" value="${cmd.name}" ${!isDisabled ? 'checked' : ''} class="sr-only peer" onchange="this.closest('.flex').classList.toggle('bg-red-500/5', !this.checked); this.closest('.flex').classList.toggle('border-red-500/10', !this.checked); this.closest('.flex').querySelector('.font-bold').classList.toggle('text-red-400', !this.checked); this.closest('.flex').classList.toggle('bg-white/5', this.checked); this.closest('.flex').classList.toggle('border-white/5', this.checked); this.closest('.flex').querySelector('.font-bold').classList.toggle('text-gray-200', this.checked);">
                                <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                            </label>
                        `;
                        grid.appendChild(cmdCard);
                    });

                    catSection.appendChild(grid);
                    container.appendChild(catSection);
                }

                // Set Values
                document.getElementById('setting-prefix').value = data.settings.prefix || '!';
                document.getElementById('setting-language').value = data.settings.language || 'tr';
                document.getElementById('setting-welcome-channel').value = data.settings.welcomeChannel || '';
                document.getElementById('setting-welcome-message').value = data.settings.welcomeMessage || '';
                document.getElementById('setting-leave-channel').value = data.settings.leaveChannel || '';
                document.getElementById('setting-leave-message').value = data.settings.leaveMessage || '';
                document.getElementById('setting-ticket-category').value = data.settings.ticketCategory || '';
                document.getElementById('setting-ticket-log').value = data.settings.ticketLogChannel || '';
                document.getElementById('setting-ticket-message').value = data.settings.ticketMessage || '';
                document.getElementById('setting-autorole').value = data.settings.autorole || '';

                // Protections
                document.getElementById('setting-anti-swear').checked = data.settings.protections?.antiSwear || false;
                document.getElementById('setting-anti-link').checked = data.settings.protections?.antiLink || false;
                document.getElementById('setting-anti-spam').checked = data.settings.protections?.antiSpam || false;
                document.getElementById('setting-anti-caps').checked = data.settings.protections?.antiCaps || false;
                document.getElementById('setting-anti-bot').checked = data.settings.protections?.antiBot || false;
                document.getElementById('setting-age-limit').value = data.settings.protections?.ageLimit || 0;
                document.getElementById('setting-banned-tags').value = (data.settings.protections?.bannedTags || []).join(', ');

                // Reset to first tab
                switchModalTab('general');

            } catch (error) {
                console.error(error);
                showToast("Sunucu bilgileri yüklenemedi: " + error.message, 'error');
                closeManageModal();
            }
        }

        function closeManageModal() {
            document.getElementById('manage-modal').classList.add('hidden');
            currentGuildId = null;
        }

        function switchModalTab(tabId) {
            // Hide all tabs
            document.querySelectorAll('.modal-tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Show selected tab
            const selectedTab = document.getElementById(`tab-${tabId}`);
            if(selectedTab) selectedTab.classList.remove('hidden');

            // Update sidebar buttons
            document.querySelectorAll('.modal-tab-btn').forEach(btn => {
                if(btn.dataset.tab === tabId) {
                    btn.classList.add('active', 'text-white', 'bg-white/5');
                    btn.classList.remove('text-gray-400');
                } else {
                    btn.classList.remove('active', 'text-white', 'bg-white/5');
                    btn.classList.add('text-gray-400');
                }
            });
        }

        // Reaction Role Functions
        function renderReactionRoles(roles) {
            const list = document.getElementById('rr-list');
            list.innerHTML = '';
            
            if (!roles || roles.length === 0) {
                list.innerHTML = '<p class="text-xs text-gray-500 text-center py-4 italic">Henüz bir emoji rol sistemi kurulmamış.</p>';
                return;
            }

            roles.forEach(rr => {
                const item = document.createElement('div');
                item.className = 'flex items-center justify-between p-3 bg-white/5 border border-white/5 rounded-xl group';
                item.innerHTML = `
                    <div class="flex items-center gap-3">
                        <span class="text-lg">${rr.emoji}</span>
                        <div class="flex flex-col">
                            <span class="text-xs font-bold text-white">Rol ID: ${rr.roleId}</span>
                            <span class="text-[10px] text-gray-500">Mesaj: ${rr.messageId}</span>
                        </div>
                    </div>
                    <button onclick="deleteReactionRole('${rr._id}')" class="text-red-500 hover:text-red-400 p-2 opacity-0 group-hover:opacity-100 transition-all">
                        <i class="fa-solid fa-trash-can"></i>
                    </button>
                `;
                list.appendChild(item);
            });
        }

        async function addReactionRole() {
            const channelId = document.getElementById('rr-channel').value;
            const messageId = document.getElementById('rr-message-id').value;
            const emoji = document.getElementById('rr-emoji').value;
            const roleId = document.getElementById('rr-role').value;

            if (!channelId || !messageId || !emoji || !roleId) {
                showToast('Tüm alanları doldurun!', 'error');
                return;
            }

            try {
                const response = await fetch(`/api/server/${currentGuildId}/reaction-role`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ channelId, messageId, emoji, roleId })
                });
                
                const result = await response.json();
                if (result.success) {
                    showToast('Emoji rol başarıyla eklendi!', 'success');
                    // Refresh modal data
                    openManageModal(currentGuildId);
                } else {
                    showToast(result.error || 'Hata oluştu', 'error');
                }
            } catch (e) {
                showToast('Sistem hatası', 'error');
            }
        }

        async function deleteReactionRole(id) {
            if (!confirm('Bu sistemi silmek istediğinize emin misiniz? Botun tepkisi silinmeyecektir.')) return;

            try {
                const response = await fetch(`/api/server/${currentGuildId}/reaction-role/${id}`, {
                    method: 'DELETE'
                });
                const result = await response.json();
                if (result.success) {
                    showToast('Sistem silindi', 'success');
                    openManageModal(currentGuildId);
                }
            } catch (e) {
                showToast('Hata oluştu', 'error');
            }
        }

        async function sendTicketMessage() {
            const channelId = document.getElementById('ticket-setup-channel').value;
            if (!channelId) {
                showToast('Lütfen bir kanal seçin!', 'error');
                return;
            }

            try {
                const response = await fetch(`/api/server/${currentGuildId}/ticket-send`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ channelId })
                });
                const result = await response.json();
                if (result.success) {
                    showToast('Ticket mesajı başarıyla gönderildi!', 'success');
                } else {
                    showToast(result.error || 'Hata oluştu', 'error');
                }
            } catch (e) {
                showToast('Sistem hatası', 'error');
            }
        }

        async function saveGuildSettings() {
            if(!currentGuildId) return;

            const btn = document.querySelector('button[onclick="saveGuildSettings()"]');
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Kaydediliyor...';

            const disabledCommands = Array.from(document.querySelectorAll('input[name="disabled-cmd"]:not(:checked)'))
                .map(cb => cb.value);

            const settings = {
                prefix: document.getElementById('setting-prefix').value,
                language: document.getElementById('setting-language').value,
                welcomeChannel: document.getElementById('setting-welcome-channel').value,
                welcomeMessage: document.getElementById('setting-welcome-message').value,
                leaveChannel: document.getElementById('setting-leave-channel').value,
                leaveMessage: document.getElementById('setting-leave-message').value,
                ticketCategory: document.getElementById('setting-ticket-category').value,
                ticketLogChannel: document.getElementById('setting-ticket-log').value,
                ticketMessage: document.getElementById('setting-ticket-message').value,
                autorole: document.getElementById('setting-autorole').value,
                disabledCommands: disabledCommands,
                protections: {
                    antiSwear: document.getElementById('setting-anti-swear').checked,
                    antiLink: document.getElementById('setting-anti-link').checked,
                    antiSpam: document.getElementById('setting-anti-spam').checked,
                    antiCaps: document.getElementById('setting-anti-caps').checked,
                    antiBot: document.getElementById('setting-anti-bot').checked,
                    ageLimit: parseInt(document.getElementById('setting-age-limit').value) || 0,
                    bannedTags: document.getElementById('setting-banned-tags').value.split(',').map(t => t.trim()).filter(t => t !== '')
                }
            };

            try {
                const response = await fetch(`/api/server/${currentGuildId}/config`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(settings)
                });
                
                const result = await response.json();
                
                if(result.success) {
                    showToast('Ayarlar başarıyla kaydedildi!', 'success');
                } else {
                    throw new Error(result.error || 'Kaydedilemedi');
                }

            } catch (error) {
                console.error(error);
                showToast(error.message, 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }

        async function leaveServer(guildId) {
            if(!confirm('Bu sunucudan ayrılmak istediğinize emin misiniz? Bu işlem geri alınamaz.')) return;

            try {
                const response = await fetch('/api/server/leave', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ guildId })
                });
                const result = await response.json();

                if(result.success) {
                    showToast(result.message, 'success');
                    closeManageModal();
                    fetchServers(); // Listeyi yenile
                    fetchBotStats(); // İstatistikleri yenile
                } else {
                    showToast(result.error || 'Bir hata oluştu', 'error');
                }
            } catch (error) {
                console.error(error);
                showToast('Sunucu hatası', 'error');
            }
        }

        // Mobile Menu Toggle
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('mobile-overlay');

        function toggleSidebar() {
            const isClosed = sidebar.classList.contains('-translate-x-full');
            if (isClosed) {
                sidebar.classList.remove('-translate-x-full');
                overlay.classList.remove('hidden');
            } else {
                sidebar.classList.add('-translate-x-full');
                overlay.classList.add('hidden');
            }
        }

        mobileMenuBtn.addEventListener('click', toggleSidebar);
        overlay.addEventListener('click', toggleSidebar);

        // Sayfa Yönetimi ve Navigasyon
        const pages = {
            overview: document.getElementById('page-overview'),
            servers: document.getElementById('page-servers'),
            commands: document.getElementById('page-commands')
        };

        function switchPage(pageId) {
            // Tüm sayfaları gizle
            Object.values(pages).forEach(page => {
                if(page) page.classList.add('hidden');
            });

            // Seçilen sayfayı göster
            const targetPage = pages[pageId];
            if (targetPage) {
                targetPage.classList.remove('hidden');
                
                // Verileri sadece yoksa çek (Pre-fetch zaten yüklemiş olmalı)
                if (pageId === 'servers' && allServers.length === 0) fetchServers();
                if (pageId === 'commands' && allCommands.length === 0) fetchCommands();
            }

            // Sidebar linklerini güncelle
            document.querySelectorAll('.sidebar-link').forEach(link => {
                link.classList.remove('active', 'text-white', 'bg-white/5');
                link.classList.add('text-gray-400');
                
                if (link.dataset.page === pageId) {
                    link.classList.add('active', 'text-white', 'bg-white/5');
                    link.classList.remove('text-gray-400');
                }
            });

            // Başlığı güncelle
            const titles = {
                overview: 'Genel Bakış',
                servers: 'Sunucularım',
                commands: 'Komutlar'
            };
            document.querySelector('header h1').innerText = titles[pageId] || 'Panel';
            
            // Mobilde menüyü kapat
            if (window.innerWidth < 768) {
                toggleSidebar();
            }
        }

        // Sidebar Link Dinleyicileri
        document.querySelectorAll('.sidebar-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const pageId = link.dataset.page;
                if (pageId) switchPage(pageId);
            });
        });

        // Veri Çekme Simülasyonu
        async function fetchBotStats() {
            try {
                // API'den veri çek
                const response = await fetch('/api/stats');
                const data = await response.json();

                // Sayıları formatla
                const formatNumber = (num) => new Intl.NumberFormat('tr-TR').format(num);
                const formatCompact = (num) => new Intl.NumberFormat('en-US', { notation: "compact", compactDisplay: "short" }).format(num);

                // DOM güncelle
                document.getElementById('stat-servers').innerText = formatNumber(data.servers);
                document.getElementById('stat-users').innerText = formatCompact(data.users);
                document.getElementById('stat-commands').innerText = formatCompact(data.commands);
                document.getElementById('stat-ping').innerText = data.ping + 'ms';

            } catch (error) {
                console.error('Veri çekme hatası:', error);
            }
        }

        async function fetchActivities() {
            try {
                const response = await fetch('/api/activities');
                const activities = await response.json();
                const listContainer = document.getElementById('activity-list');
                
                if (!listContainer) return;

                listContainer.innerHTML = ''; // Temizle

                activities.forEach(activity => {
                    const itemHTML = `
                        <div class="flex items-center gap-4 p-3 rounded-xl hover:bg-white/5 transition-colors cursor-pointer group animate-fade-in">
                            <div class="w-10 h-10 rounded-full bg-${activity.color}-500/20 flex items-center justify-center text-${activity.color}-500">
                                <i class="fa-solid ${activity.icon}"></i>
                            </div>
                            <div class="flex-1">
                                <p class="text-sm font-medium text-white group-hover:text-purple-400 transition-colors">${activity.text}</p>
                                <p class="text-xs text-gray-500">${activity.detail} • ${activity.time}</p>
                            </div>
                            <span class="text-xs font-bold text-${activity.color}-400 bg-${activity.color}-400/10 px-2 py-1 rounded">İşlem</span>
                        </div>
                    `;
                    listContainer.insertAdjacentHTML('beforeend', itemHTML);
                });

            } catch (error) {
                console.error('Aktivite çekme hatası:', error);
            }
        }

        // Sunucuları Çek
        let allServers = []; // Arama için önbellek

        async function fetchServers() {
            const listContainer = document.getElementById('server-list');
            const countBadge = document.getElementById('server-count-badge');
            
            try {
                const response = await fetch('/api/servers');
                allServers = await response.json();
                
                if (countBadge) countBadge.innerText = allServers.length;
                renderServers(allServers);

            } catch (error) {
                console.error('Sunucu listesi hatası:', error);
                listContainer.innerHTML = '<div class="text-center text-red-500 py-12 col-span-full">Sunucu listesi yüklenemedi.</div>';
            }
        }

        function renderServers(servers) {
            const listContainer = document.getElementById('server-list');
            listContainer.innerHTML = '';

            if (servers.length === 0) {
                listContainer.innerHTML = '<div class="text-center text-gray-500 py-12 col-span-full">Sunucu bulunamadı.</div>';
                return;
            }

            servers.forEach(server => {
                const cardHTML = `
                    <div class="glass-panel p-4 rounded-xl hover:bg-white/5 transition-all group animate-fade-in border border-white/5 hover:border-purple-500/30">
                        <div class="flex items-center gap-4 mb-4">
                            <img src="${server.icon}" alt="${server.name}" class="w-12 h-12 rounded-full border-2 border-purple-500/20 group-hover:border-purple-500 transition-colors">
                            <div class="flex-1 min-w-0">
                                <h3 class="font-bold text-white truncate">${server.name}</h3>
                                <p class="text-xs text-gray-400 flex items-center gap-1">
                                    <i class="fa-solid fa-users text-[10px]"></i> ${server.memberCount} Üye
                                </p>
                            </div>
                            ${server.owner ? '<span class="text-[10px] font-bold text-yellow-500 bg-yellow-500/10 px-2 py-0.5 rounded border border-yellow-500/20">SAHİP</span>' : ''}
                        </div>
                        <div class="flex gap-2 mt-2">
                            <button onclick="openManageModal('${server.id}')" class="flex-1 bg-white/5 hover:bg-purple-600 text-gray-300 hover:text-white text-xs font-bold py-2 rounded-lg transition-colors">
                                Yönet
                            </button>
                            <button onclick="leaveServer('${server.id}')" class="flex-1 bg-white/5 hover:bg-red-600 text-gray-300 hover:text-white text-xs font-bold py-2 rounded-lg transition-colors">
                                Ayrıl
                            </button>
                        </div>
                    </div>
                `;
                listContainer.insertAdjacentHTML('beforeend', cardHTML);
            });
        }

        // Komutları Çek
        let allCommands = []; // Arama için önbellek

        async function fetchCommands() {
            const tableBody = document.getElementById('command-list');
            
            try {
                const response = await fetch('/api/commands');
                allCommands = await response.json();
                
                renderCommands(allCommands);

            } catch (error) {
                console.error('Komut listesi hatası:', error);
                tableBody.innerHTML = '<tr><td colspan="4" class="text-center text-red-500 py-8">Komutlar yüklenemedi.</td></tr>';
            }
        }

        function renderCommands(commands) {
            const tableBody = document.getElementById('command-list');
            tableBody.innerHTML = '';

            if (commands.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="4" class="text-center text-gray-500 py-8">Komut bulunamadı.</td></tr>';
                return;
            }

            commands.forEach(cmd => {
                const rowHTML = `
                    <tr class="hover:bg-white/5 transition-colors animate-fade-in group">
                        <td class="px-6 py-4 font-mono text-purple-400 font-bold group-hover:text-purple-300 transition-colors">${cmd.name}</td>
                        <td class="px-6 py-4 text-gray-400">${cmd.description}</td>
                        <td class="px-6 py-4">
                            <span class="bg-white/5 text-gray-300 px-2 py-1 rounded text-xs border border-white/10">${cmd.category}</span>
                        </td>
                        <td class="px-6 py-4 font-mono text-xs text-gray-500">${cmd.usage}</td>
                    </tr>
                `;
                tableBody.insertAdjacentHTML('beforeend', rowHTML);
            });
        }

        // Komut Arama (Yerel - Sayfa içindeki arama kutusu için)
        const commandSearch = document.getElementById('command-search');
        if (commandSearch) {
            commandSearch.addEventListener('input', (e) => {
                const term = e.target.value.toLowerCase();
                // Global search kutusunu da güncelle ki senkron olsunlar
                if (globalSearch) globalSearch.value = term;
                
                const filtered = allCommands.filter(cmd => 
                    cmd.name.toLowerCase().includes(term) || 
                    cmd.description.toLowerCase().includes(term) ||
                    cmd.category.toLowerCase().includes(term)
                );
                renderCommands(filtered);
            });
        }

        // Bildirim Sistemi Mantığı
        const notificationBtn = document.getElementById('notification-btn');
        const notificationDropdown = document.getElementById('notification-dropdown');
        const notificationBadge = document.getElementById('notification-badge');
        const notificationList = document.getElementById('notification-list');

        let notifications = [];

        notificationBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            notificationDropdown.classList.toggle('hidden');
            notificationBadge.classList.add('hidden'); // Bildirimlere bakınca kırmızı noktayı kaldır
        });

        // Dışarı tıklayınca kapat
        document.addEventListener('click', () => {
            notificationDropdown.classList.add('hidden');
        });

        notificationDropdown.addEventListener('click', (e) => e.stopPropagation());

        function clearNotifications() {
            notifications = [];
            renderNotifications();
            notificationBadge.classList.add('hidden');
        }

        function renderNotifications() {
            if (notifications.length === 0) {
                notificationList.innerHTML = `
                    <div class="p-8 text-center">
                        <i class="fa-solid fa-bell-slash text-2xl text-gray-600 mb-2"></i>
                        <p class="text-xs text-gray-500">Henüz yeni bir bildirim yok.</p>
                    </div>
                `;
                return;
            }

            notificationList.innerHTML = notifications.map(notif => `
                <div class="px-4 py-3 hover:bg-white/5 transition-colors cursor-pointer border-b border-white/5 last:border-0 flex gap-3">
                    <div class="w-8 h-8 rounded-full bg-${notif.color}-500/10 flex items-center justify-center text-${notif.color}-500 flex-shrink-0 mt-1">
                        <i class="fa-solid ${notif.icon} text-xs"></i>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-xs font-bold text-white truncate">${notif.text}</p>
                        <p class="text-[10px] text-gray-500 mt-0.5">${notif.detail}</p>
                        <p class="text-[9px] text-gray-600 mt-1">${notif.time}</p>
                    </div>
                </div>
            `).join('');
            
            notificationBadge.classList.remove('hidden');
        }

        // Aktiviteleri bildirimlere dönüştür (Sadece son 5 tanesini alalım)
        async function updateNotificationsFromActivities() {
            try {
                const response = await fetch('/api/activities');
                const activities = await response.json();
                
                // Sadece yeni aktiviteleri ekleyelim veya listeyi güncelleyelim
                const newNotifications = activities.slice(0, 5);
                
                // Eğer liste değişmişse güncelle
                if (JSON.stringify(newNotifications) !== JSON.stringify(notifications)) {
                    notifications = newNotifications;
                    renderNotifications();
                }
            } catch (error) {
                console.error('Bildirim güncelleme hatası:', error);
            }
        }

        // Global Arama Mantığı
        const globalSearch = document.getElementById('global-search');
        if (globalSearch) {
            globalSearch.addEventListener('input', (e) => {
                const term = e.target.value.toLowerCase().trim();
                
                // Hangi sayfadayız?
                const activePage = Object.keys(pages).find(key => pages[key] && !pages[key].classList.contains('hidden'));
                
                if (!term) {
                    // Arama temizlendiyse her şeyi resetle
                    if (allServers.length > 0) renderServers(allServers);
                    if (allCommands.length > 0) renderCommands(allCommands);
                    return;
                }

                const serverMatches = allServers.filter(s => s.name.toLowerCase().includes(term));
                const commandMatches = allCommands.filter(cmd => 
                    cmd.name.toLowerCase().includes(term) || 
                    cmd.description.toLowerCase().includes(term) ||
                    cmd.category.toLowerCase().includes(term)
                );

                if (activePage === 'servers') {
                    renderServers(serverMatches);
                } else if (activePage === 'commands') {
                    renderCommands(commandMatches);
                } else {
                    // Overview sayfasındayken arama yapılırsa
                    // Öncelik sunucularda olsun, yoksa komutlara baksın
                    if (serverMatches.length > 0) {
                        switchPage('servers');
                        renderServers(serverMatches);
                    } else if (commandMatches.length > 0) {
                        switchPage('commands');
                        renderCommands(commandMatches);
                    }
                }
            });
        }

        // Hızlı İşlemler İçin Dinleyici
        function setupQuickActions() {
            const buttons = document.querySelectorAll('.quick-action-btn'); 
            buttons.forEach(btn => {
                // Remove old listeners to prevent duplicates (if any)
                const newBtn = btn.cloneNode(true);
                btn.parentNode.replaceChild(newBtn, btn);
                
                newBtn.addEventListener('click', async (e) => {
                    // Butona tıklanınca parent'ı (button) bul
                    const targetBtn = e.currentTarget;
                    const action = targetBtn.dataset.action;
                    
                    if(!action) return;

                    // Duyuru işlemi için özel durum
                    let announceMsg = null;
                    if (action === 'announce') {
                        announceMsg = prompt("Sunucu sahiplerine gönderilecek duyuru metnini girin:");
                        if (!announceMsg) return;
                    }

                    const originalContent = targetBtn.innerHTML;
                    
                    // Yükleniyor durumu
                    targetBtn.classList.add('opacity-70', 'cursor-not-allowed');
                    targetBtn.querySelector('div').innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i>';

                    try {
                        // Gerçek bir işlem yapıyormuş gibi bekle
                        await new Promise(r => setTimeout(r, 800));

                        const response = await fetch('/api/action', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ action, message: announceMsg })
                        });
                        
                        // Check if the response is actually OK
                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.error || 'İşlem başarısız');
                        }

                        const result = await response.json();
                        
                        if(result.success) {
                            showToast(result.message, 'success');
                            if(result.mode !== undefined) {
                                updateMaintenanceButton(result.mode);
                            }
                        } else {
                            showToast(result.error || 'İşlem başarısız!', 'error');
                        }
                    } catch(err) {
                        console.error(err);
                        showToast(err.message || 'Bir hata oluştu.', 'error');
                    } finally {
                        // Eski haline getir
                        targetBtn.classList.remove('opacity-70', 'cursor-not-allowed');
                        targetBtn.innerHTML = originalContent;
                    }
                });
            });
        }

        // Sistem Sağlığı Verilerini Çek
        async function fetchSystemHealth() {
            try {
                const response = await fetch('/api/health');
                const data = await response.json();

                // CPU Bar
                updateProgressBar('cpu-bar', data.cpu);
                const cpuText = document.getElementById('cpu-text');
                if(cpuText) cpuText.innerText = `%${data.cpu}`;

                // RAM Bar
                updateProgressBar('ram-bar', data.ram);
                const ramText = document.getElementById('ram-text');
                if(ramText) ramText.innerText = `%${data.ram}`;

                // Disk Bar
                updateProgressBar('disk-bar', data.disk);
                const diskText = document.getElementById('disk-text');
                if(diskText) diskText.innerText = `%${data.disk}`;

            } catch (error) {
                console.error('Sistem verisi hatası:', error);
            }
        }

        function updateProgressBar(id, value) {
            const bar = document.getElementById(id);
            if(bar) {
                bar.style.width = `${value}%`;
                // Renk değişimi
                if(value > 80) {
                    bar.className = bar.className.replace(/bg-\w+-500/g, 'bg-red-500');
                } else if(value > 50) {
                    bar.className = bar.className.replace(/bg-\w+-500/g, 'bg-yellow-500');
                } else {
                    // Orijinal rengine dönmek için basit bir mantık veya sabit yeşil
                    // Burada basitleştirmek için yeşil yapalım, ya da id'ye göre renk atayabiliriz
                    if (id.includes('cpu')) bar.className = bar.className.replace(/bg-\w+-500/g, 'bg-purple-500');
                    else if (id.includes('ram')) bar.className = bar.className.replace(/bg-\w+-500/g, 'bg-yellow-500');
                    else bar.className = bar.className.replace(/bg-\w+-500/g, 'bg-blue-500');
                }
            }
        }

        // Basit Toast Bildirimi
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `fixed bottom-4 right-4 px-6 py-3 rounded-xl text-white font-medium shadow-lg transform translate-y-20 transition-all duration-300 z-50 ${type === 'success' ? 'bg-green-600' : 'bg-red-600'}`;
            toast.innerHTML = `<i class="fa-solid ${type === 'success' ? 'fa-check' : 'fa-triangle-exclamation'} mr-2"></i> ${message}`;
            document.body.appendChild(toast);
            
            requestAnimationFrame(() => toast.classList.remove('translate-y-20'));

            setTimeout(() => {
                toast.classList.add('translate-y-20', 'opacity-0');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function updateMaintenanceButton(isActive) {
            const btn = document.querySelector('[data-action="maintenance"]');
            if(btn) {
                const iconDiv = btn.querySelector('div');
                if(isActive) {
                    btn.classList.add('ring-2', 'ring-yellow-500');
                    iconDiv.classList.remove('text-yellow-500', 'bg-yellow-500/20');
                    iconDiv.classList.add('text-white', 'bg-yellow-500');
                } else {
                    btn.classList.remove('ring-2', 'ring-yellow-500');
                    iconDiv.classList.add('text-yellow-500', 'bg-yellow-500/20');
                    iconDiv.classList.remove('text-white', 'bg-yellow-500');
                }
            }
        }

        // Sayfa yüklendiğinde ve her 3 saniyede bir verileri güncelle
        document.addEventListener('DOMContentLoaded', async () => {
            const isLoggedIn = await checkAuth();
            if (!isLoggedIn) return; // Stop if not logged in

            // Verileri pre-fetch et (Arama için önemli)
            fetchServers();
            fetchCommands();

            fetchBotStats();
            fetchActivities();
            fetchSystemHealth();
            updateNotificationsFromActivities();
            setupQuickActions();
            
            // Varsayılan olarak overview sayfasını aç
            switchPage('overview');
            
            setInterval(() => {
                // Sadece overview sayfası açıksa istatistikleri güncelle
                if (!document.getElementById('page-overview').classList.contains('hidden')) {
                    fetchBotStats();
                    fetchSystemHealth();
                }
            }, 3000); 
            
            setInterval(() => {
                if (!document.getElementById('page-overview').classList.contains('hidden')) {
                    fetchActivities();
                    updateNotificationsFromActivities();
                }
            }, 5000);
        });

        // Basit animasyon için CSS ekle
        const style = document.createElement('style');
        style.innerHTML = `
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            .animate-fade-in {
                animation: fadeIn 0.4s ease-out forwards;
            }
        `;
        document.head.appendChild(style);

    </script>
</body>
</html>